import acitoolkit.acitoolkit as aci
from acitoolkit import Subnet
# Replace with your APIC credentials
APIC_URL = "https://x.x.x.x1"
LOGIN = "xxxx"
PASSWORD = open(r'C:\Users\xxxxx\PycharmProjects\pwd.txt').readline()

def main():
    f = open("result.csv", "w+")
    f.write("BD, Subnet")
    # Connect to the APIC
    session = aci.Session(APIC_URL, LOGIN, PASSWORD)
    resp = session.login()
    if not resp.ok:
        print(f"Error connecting to APIC: {resp.text}")
        return

    # Get tenants
    tenants = aci.Tenant.get(session)

    print("Bridge Domains and IP Information:")
    for tenant in tenants:
        tenant_name = tenant.name
        print(f"\nTenant: {tenant_name}")
        f.write("\n" + str(tenant_name))
        # Get bridge domains for the tenant
        bridge_domains = aci.BridgeDomain.get(session, tenant)

        for bd in bridge_domains:
            bd_name = bd.name
            print(f"  Bridge Domain: {bd_name}")
            f.write("\n" + str(bd_name))
            # Get IP information (subnets) for the bridge domain
            subnets = subnets = Subnet.get(session, bd, tenant)
            for subnet in subnets:
                ip_addr = subnet.addr
                print(f"    IP Information: {ip_addr}")
                f.write("," + str(ip_addr))
    f.close()
if __name__ == "__main__":
    main()
